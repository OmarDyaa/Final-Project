<header class="border-b shadow-md p-3 w-full fixed top-0 z-50 bg-white">
  <div
    class="flex flex-col md:flex-row md:items-center justify-between max-w-screen-2xl mx-auto"
  >
    <div class="flex justify-between items-center">
      <img
        routerLink="/"
        src="/images/logo.png"
        alt="app logo"
        class="max-h-14 cursor-pointer transition-transform hover:scale-105"
      />
      <button mat-icon-button class="md:hidden" (click)="toggleMobileMenu()">
        <mat-icon>{{ isMobileMenuOpen ? "close" : "menu" }}</mat-icon>
      </button>
    </div>

    <nav class="hidden md:flex gap-8 my-2 font-medium tracking-wide">
      <a
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="nav-link"
        >HOME</a
      >
      <a routerLink="/shop" routerLinkActive="active" class="nav-link">SHOP</a>
      <a routerLink="/test-error" routerLinkActive="active" class="nav-link"
        >ERRORS</a
      >
      <a
        *appIsAdmin
        routerLink="/admin"
        routerLinkActive="active"
        class="nav-link"
        >ADMIN</a
      >

      <a class="nav-link">CONTACT US</a>
    </nav>

    <!-- Mobile navigation menu -->
    <nav
      *ngIf="isMobileMenuOpen"
      class="md:hidden flex flex-col gap-4 py-3 text-center font-medium animate-slideDown"
    >
      <a
        routerLink="/"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
        class="nav-link py-2"
        (click)="toggleMobileMenu()"
        >HOME</a
      >
      <a
        routerLink="/shop"
        routerLinkActive="active"
        class="nav-link py-2"
        (click)="toggleMobileMenu()"
        >SHOP</a
      >
      <a
        routerLink="/test-error"
        routerLinkActive="active"
        class="nav-link py-2"
        (click)="toggleMobileMenu()"
        >ERRORS</a
      >
      <a class="nav-link py-2" (click)="toggleMobileMenu()">CONTACT US</a>
    </nav>

    <div class="hidden md:flex gap-3 items-center">
      <a
        routerLink="/cart"
        routerLinkActive="active"
        matBadge="{{ cartservice.itemsCount() }}"
        matBadgeSize="large"
        class="custom-badge mt-1 mr-2 hover:text-primary transition-colors"
      >
        <mat-icon>shopping_cart</mat-icon>
      </a>
      @if(accountService.currentUser()){
      <span class="text-sm font-medium truncate max-w-[120px]">{{
        accountService.currentUser()?.email
      }}</span>
      <mat-icon class="cursor-pointer" [mat-menu-trigger-for]="menu"
        >arrow_drop_down</mat-icon
      >
      }@else {
      <button routerLink="/account/login" mat-stroked-button class="login-btn">
        Login
      </button>
      <button
        routerLink="/account/register"
        mat-stroked-button
        class="register-btn"
      >
        Register
      </button>
      }
    </div>

    <!-- Mobile user actions -->
    <div
      class="md:hidden flex justify-end items-center gap-3 mt-2"
      *ngIf="!isMobileMenuOpen"
    >
      <a
        routerLink="/cart"
        routerLinkActive="active"
        matBadge="{{ cartservice.itemsCount() }}"
        matBadgeSize="small"
        class="custom-badge"
      >
        <mat-icon>shopping_cart</mat-icon>
      </a>
      @if(accountService.currentUser()){
      <mat-icon [mat-menu-trigger-for]="menu">account_circle</mat-icon>
      }@else {
      <button routerLink="/account/login" mat-icon-button>
        <mat-icon>login</mat-icon>
      </button>
      }
    </div>
  </div>
</header>

<mat-menu #menu="matMenu">
  @if(accountService.currentUser()){
  <div class="px-4 py-2 text-gray-600 text-sm font-medium border-b">
    {{ accountService.currentUser()?.email }}
  </div>
  <button mat-menu-item class="px-3" routerLink="/account/profile">
    <mat-icon>account_circle</mat-icon>
    My Profile
  </button>
  <button mat-menu-item class="px-3" routerLink="/cart">
    <mat-icon>shopping_cart</mat-icon>
    <span>My cart</span>
  </button>
  <button mat-menu-item class="px-3" routerLink="/orders">
    <mat-icon>history</mat-icon>
    <span>My orders</span>
  </button>
  <mat-divider></mat-divider>
  <button mat-menu-item class="px-3" (click)="logout()">
    <mat-icon>logout</mat-icon>
    <span>Logout</span>
  </button>
  }
</mat-menu>

@if(busyService.loading){
<mat-progress-bar
  mode="indeterminate"
  class="fixed top-16 z-50"
></mat-progress-bar>
}
